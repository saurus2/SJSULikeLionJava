<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />
    <title>Home Page</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f2f2f2;
        margin: 0;
        padding: 0;
      }

      h2 {
        text-align: center;
      }

      * {
        transition: 0.1s;
      }

      button {
        background-color: rgb(255 119 17);
        color: white;
        cursor: pointer;
      }
      button:hover {
        background-color: rgba(255, 120, 17, 0.639);
      }

      /* 네비게이션 바 스타일 */
      .navbar {
        height: 60px;
        background-color: #959595;
        color: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 20px;
        position: sticky;
        top: 0;
      }

      .nav-right {
        display: flex;
        align-items: center;
      }

      .upload-btn {
        padding: 5px;
        border-radius: 100px;
        cursor: pointer;
      }

      .upload-btn:hover {
        color: rgb(255 119 17);
        background: rgba(0, 0, 0, 0.5);
      }

      /* 모달 뒷 배경 */
      .upload-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
      }

      /* 모달 가운데 정렬 */
      .upload-modal-content-container {
        display: grid;
        height: 100vh;
        place-content: center;
      }

      /* 모달 스타일 */
      .upload-modal-content {
        display: flex;
        flex-direction: column;
        justify-content: center;
        width: 30vw;
        min-width: 350px;
        max-width: 450px;
        background-color: #f2f2f2;
        color: #252525;
        margin: auto;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
        border-radius: 5px;
      }

      .upload-modal-header {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 20px;
        width: 100%;
        padding: 10px 0;
        box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 2px 0px;
        font-size: 15px;
      }

      .caption-container {
        width: 100%;
        margin: 10px 0;
        box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 2px 0px;
      }
      .caption-input {
        display: block;
        max-width: 100%;
        padding: 10px;
        min-height: 22px;
        line-height: 15px;
        font-size: 20px;
        outline: none;
        overflow: hidden;
        resize: none;
        cursor: text;
      }

      span[contenteditable]:empty:focus::before,
      span[contenteditable]:empty::before {
        content: "Write a caption...";
        color: gray;
      }

      /* 모달 닫기 버튼 */
      .upload-modal-close {
        position: absolute;
        right: 15px;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
      }

      /* 모달 Upload 버튼 스타일 */
      #uploadBtn {
        border: none;
        padding: 10px 20px;
        width: fit-content;
        font-size: 14px;
        border-radius: 5px;
        cursor: pointer;
        float: right;
      }

      /* 모달 Select 버튼 스타일 */
      #selectBtn {
        background-color: rgb(255 119 17);
        color: #fff;
        border: none;
        padding: 10px 20px;
        font-size: 14px;
        border-radius: 5px;
        cursor: pointer;
      }
      #selectBtn:hover {
        background-color: rgba(255, 120, 17, 0.639);
      }

      /* 모달 내 미리보기 화면 최대 크기 제한 */
      #selectedImage {
        max-width: 100%;
        max-height: 500px;
        height: auto;
      }

      /* 모달 내 미리보기 화면 가운데 정렬 */
      #selectedImageContainer {
        display: flex;
        justify-content: center;
        align-items: center;
      }

      /* 모달 Select 버튼과 Upload 버튼 정렬 */
      .flex-row {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        margin: 0 20px 10px 20px;
      }

      .nav-left {
        display: flex;
        align-items: center;
      }

      .logo {
        width: 50px;
        height: 30px;
        margin-right: 10px;
      }

      /* 로그인 버튼 스타일 */
      .log-button {
        margin-left: 20px;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
      }

      /* 메인 */
      .card {
        width: 400px;
        margin: 50px auto;
        background-color: #fff;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      }

      .card img {
        width: 100%;
      }

      .card-header {
        font-size: 18px;
        font-weight: bold;
        padding: 10px;
      }

      .card-description {
        padding: 10px;
      }

      .card-buttons {
        display: flex;
        justify-content: flex-end;
        align-items: center;
        gap: 5px;
        padding: 10px;
      }

      .card-button {
        background: transparent;
        border: none;
        cursor: pointer;
      }

      .card-button:hover {
        color: rgb(242, 166, 0);
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-client-s3.js"></script>
    <script>
      var albumBucketName = "BUCKET_NAME";
      var bucketRegion = "REGION";
      var IdentityPoolId = "IDENTITY_POOL_ID";

      AWS.config.update({
        region: bucketRegion,
        credentials: new AWS.CognitoIdentityCredentials({
          IdentityPoolId: IdentityPoolId,
        }),
      });

      var s3 = new AWS.S3({
        apiVersion: "2006-03-01",
        params: { Bucket: albumBucketName },
      });
    </script>
  </head>
  <body>
    <div class="navbar">
      <div class="nav-left">
        <img
          class="logo"
          src="https://upload.wikimedia.org/wikipedia/commons/4/48/LIKELION_brandsymbol.png"
          alt="logo"
        />
        <h1>멋스타그램</h1>
      </div>
      <div class="nav-center">
        <div class="upload-btn">
          <span class="material-symbols-outlined" id="openModalBtn">
            add_to_photos
          </span>
        </div>

        <!-- 모달 -->
        <div id="myModal" class="upload-modal">
          <div class="upload-modal-content-container">
            <div class="upload-modal-content">
              <div class="upload-modal-header">
                <span class="upload-modal-close" id="closeModalBtn"
                  >&times;</span
                >
                <span style="padding-left: 22px">New Post</span>
              </div>
              <div id="selectedImageContainer">
                <img
                  id="selectedImage"
                  src="#"
                  alt="Selected Image"
                  style="display: none; max-width: 100%"
                />
              </div>
              <div class="caption-container">
                <span
                  class="caption-input"
                  role="textbox"
                  contenteditable
                ></span>
              </div>
              <div class="flex-row">
                <label for="fileInput">
                  <div id="selectBtn">Upload Image</div>
                </label>
                <input
                  type="file"
                  id="fileInput"
                  style="padding: 7px; display: none"
                />
                <button id="uploadBtn">Share</button>
              </div>
              <div id="uploadStatus"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="nav-right">
        <div class="welcome"></div>
        <a style="display: none" class="login-btn" href="/login">
          <button class="log-button login-button">Sign in</button>
        </a>
        <a style="display: none" class="logout-btn" href="/">
          <button class="log-button logout-button">Sign out</button>
        </a>
      </div>
    </div>
    <div class="container">
      <!-- A card -->
      <div class="card">
        <div class="card-header">The Red Wheelbarrow</div>
        <img
          class="card-img"
          src="https://i0.wp.com/digital-photography-school.com/wp-content/uploads/2012/10/image1.jpg?w=600&h=1260&ssl=1"
          alt="사진 1"
        />
        <div class="card-description">
          The most anthologized poem of the last 25 years for a reason. See
          also: “This is Just to Say,” which, among other things, has spawned a
          host of memes and parodies.
        </div>
        <div class="card-buttons">
          <button class="card-button">
            <span class="material-symbols-outlined"> pets </span>
          </button>
          <button class="card-button">
            <span class="material-symbols-outlined"> comment </span>
          </button>
        </div>
      </div>
    </div>
  </body>
  <!-- 로그인 기능 -->
  <script>
    const login_btn = document.querySelector(".login-btn");
    const logout_btn = document.querySelector(".logout-btn");
    const welcome = document.querySelector(".welcome");

    // if logged in
    function checkLogin() {
      // Logged in
      if (localStorage.getItem("user_info")) {
        logout_btn.style.display = "block";
        welcome.innerHTML = `Welcome, ${
          JSON.parse(localStorage["user_info"]).name
        }.`;
      }
      // logged out
      else {
        login_btn.style.display = "block";
      }
    }

    logout_btn.addEventListener("click", () => {
      localStorage.removeItem("user_info");
    });

    function main() {
      checkLogin();
    }

    main();
  </script>

  <!-- 업로드 관련 -->
  <script>
    const openModalBtn = document.getElementById("openModalBtn");
    const modal = document.getElementById("myModal");
    const closeModalBtn = document.getElementById("closeModalBtn");
    const fileInput = document.getElementById("fileInput");
    const uploadStatus = document.getElementById("uploadStatus");
    const uploadBtn = document.getElementById("uploadBtn");
    const captionInput = document.querySelector(".caption-input");

    openModalBtn.addEventListener("click", function () {
      // 로그인 정보가 있을 때
      if (localStorage.getItem("user_info")) {
        modal.style.display = "block";
      }
      // 로그인 정보가 없을 때
      else {
        alert("Log in first");
        window.location.href = "/login";
      }
    });

    // 모달 닫기 버튼 클릭 시 모달 닫기
    closeModalBtn.addEventListener("click", function () {
      modal.style.display = "none";
    });

    // 파일 업로드 함수
    uploadBtn.addEventListener("click", function () {
      const file = fileInput.files[0];

      if (file) {
        const pic_id = Math.random().toString(36).substring(2, 10);
        const data = {
          writer_id: JSON.parse(localStorage.user_info).user_id,
          pic_id,
          content: captionInput.innerText,
          roars_count: 0,
        };

        console.log(data);

        // 서버에 post 요청
        axios({
          method: "post",
          url: "/post/upload",
          data,
        })
          .then((response) => {
            console.log(response);
          })
          .catch((error) => {
            console.log(error);
          });
        // S3에 업로드
        var s3 = new AWS.S3();
        s3.abortMultipartUpload(params, function (err, data) {
          if (err) console.log(err, err.stack); // an error occurred
          else console.log(data); // successful response
        });
      }
    });

    // 파일 입력 상자의 변경 이벤트 감지
    document
      .getElementById("fileInput")
      .addEventListener("change", function () {
        var selectedImage = document.getElementById("selectedImage");
        var uploadStatus = document.getElementById("uploadStatus");

        // 선택한 파일이 없으면 아무것도 하지 않음
        if (!this.files.length) {
          selectedImage.style.display = "none";
          return;
        }

        // 선택한 파일을 이미지 요소에 표시
        var file = this.files[0];
        var reader = new FileReader();
        reader.onload = function (e) {
          selectedImage.src = e.target.result;
          selectedImage.style.display = "block";
        };
        reader.readAsDataURL(file);
      });
  </script>
</html>
